# 4th 회의록

## 진행상황 보고

### 1. 실시간 물체인식 프레임 개선

#### 실시간 영상 속 물체인식 프레임 

+ |                   보드                    |     프레임     |
    | :---------------------------------------: | :------------: |
    |              라즈베리파이 4               |   0.1 프레임   |
    |      라즈베리파이 4 + YOLO tiny 모델      |   1.8 프레임   |
    | **라즈베리파이 4 + YOLO tiny + PRN 모델** | **2.8 프레임** |
    | 라즈베리파이 4 + YOLO tiny + PRN + NNPACK |    8 프레임    |
    |          **엔비디아 젯슨 나노**           | **10 프레임**  |

+ 현재 프레임을 약 **3프레임**까지 개선했습니다. 

    + 최적 설정: 이미지 해상도 `1024x768`, blob 이미지 크기 `224x224` 
        + 이미지 해상도를 더 낮출시 가스량 측정이 안됩니다.
        + Blob 이미지 해상도를 더 낮출시 라이터 인식이 제대로 되지 않습니다. 
    + NNPACK을 사용해서 개선하려고 몇 일 시도했지만 실패했습니다.  

+ **젯슨 나노**를 사용한다면 

    + 장점1: 고해상도(`1920x1080`)로 실시간 물체인식이 가능합니다.
    + 단점1: 라즈베리파이 키트보다 더 비쌉니다. (라즈베리파4 키트 12만원 < 젯슨 나노 키트 22만원)

### 2. 문제상황1 솔루션 개발

![front_equal](C:\Users\cydph\Desktop\test\processed\front_equal.jpg)

![front_equal_1](C:\Users\cydph\Desktop\test\processed\front_equal_1.jpg)

+ 현재 가스량에 대한 **조건**은 다음 두 가지입니다.

    1. 동일한 과정을 거치게 되는 라이터는 1개 set (10개)가 <span style="color:orange">**모두 비슷한 가스 높이**를 </span>가집니다.
    2. <span style="color:orange">**대부분의 경우**</span>에 양쪽 가스량은  <span style="color:orange">중앙턱을 기준으로 비슷한 높이</span>를 가집니다. 

+ 현재 가스량은 그 위치에 따라 5가지 경우로 나눌 수 있습니다.

    1. 앞쪽 가스량이 뒤쪽 가스량보다 매우 높은 경우 (앞쪽 가스량이 중앙 턱에 위치)
    2. 앞쪽 가스량이 뒤쪽 가스량보다 높은 경우
    3. 앞쪽 가스량과 뒤쪽 가스량이 같은 경우
    4. 앞쪽 가스량이 뒤쪽 가스량보다 적은 경우
    5. 앞쪽 가스량이 뒤쪽 가스량보다 매우 적은 경우 (뒤쪽 가스량이 중앙 턱에 위치)

+ 업체측에서 제공해준 정보로 가스량 정상 범위 (빨간색 테두리 박스)를 설정해두면 10개 라이터의 일정한 중앙턱 높이를 노란색 선으로 설정합니다.

    (가능한 이유: 카메라는 고정된 위치에 있고, 라이터도 고정된 위치에 등장하기 때문)

+ 정상 범위 내에서 선이 2개 인식되는 경우가 경우의 수 2, 4에 해당합니다.

+ 정상 범위 내에서 선이 1개 인식되는 경우가 경우의 수 1, 3, 5에 해당합니다.

+ 결과적으로 정상 범위 내에서 선이 인식되지 않은 경우는 다음 두 가지에 해당합니다.

    1. 양 쪽의 가스량이 너무 **적어** 정상 범위내에 선이 인식되지 않음 -> **가스량 미달**
    2. 양 쪽의 가스량이 너무 **많아** 정상 범위내에 선이 인식되지 않음 -> **가스량 초과**

+ 본 솔루션으로 진행할 경우, 라즈베리파이 2개의 통신은 불필요합니다. 

    

### 3. 문제상황2 솔루션 개발

![image-20200827150811420](C:\Users\cydph\AppData\Roaming\Typora\typora-user-images\image-20200827150811420.png)

+   <span style="color:orange">**탬플릿매칭**</span>을 적용했습니다.
    위 사진에서는 3, 4번째 라이터에 스티커가 잘못부착됐고, 오른쪽에서 이를 정상적으로 판별한 것을 확인할 수 있습니다.

![image-20200827150954721](C:\Users\cydph\AppData\Roaming\Typora\typora-user-images\image-20200827150954721.png)

+ 위 사진은 5번째 라이터에서 스티커가 아주 살짝 올라가서 부착된 애매한 케이스에 대해서도 잘 판단하는것을 확인할 수 있습니다.

#### 개선할 사항

+ 오류가 발생한 상황을 잘 잡아내지만 **몇 번째 라이터에서 오류가 발생했는지**는 제대로 잡지 못합니다.
+ 따라서 원본(정상인 경우의 사진)과 비교 대상(오류가 있는 사진)을 비교할 때 전체 사진으로 템플릿 매칭을 수행하지 않고, 각 n번째 라이터끼리만 비교하도록 수행하고자 합니다.  

## 다음 주 진행 예정

### 0. 공장사진 확보 위해 라즈베리파이 2개 설치 (목요일 AM 11:00 이강우교수님 집합)

+ 와이파이 가능 여부
    + 와이파이 설치 했다고 함 (proofed by 이강우 교수님)
+ 콘센트 설치 가능 여부 (라즈베리파이 1개당 2구 필요)
    + 바로 설치 가능하다고 함 (proofed by 이강우 교수님)
+ LED 패널 및 스탠드 구매 (가스량 측정을 위해서)
    + LED 패널/스탠드가 어디어디 필요한지 생각도 해봐야 함.
        + 파이카메라 역광 문제 확실하게 파악하기.
    + 시간에 따라서 결과가 변하는지도 파악해야 함.
        + 즉, 스티커 측정하는 장소에도 LED 패널/스탠드가 필요한지 파악하기.

### 1. 문제상황1 솔루션 개발 완료

### 2. 문제상황2 솔루션 개발 완료

### 3. 통합 솔루션 개발 시작 (9월 중 완성하기)



### 4. 불량품 발견시 조치

+ 불량을 발견했을 때 어떤 조치를 하는게 좋을까?
    + 불량률 파악을 위해 어떤 불량이 어느 위치에서 몇 시 몇 분에 났는지 **로그를 남긴다**.
    + 경고(알림)를 어떤 방식으로 알려주는게 좋을까?

----



